import{b as f,u as j,r as t,j as e}from"./index-D0Dq44PN.js";import{s as c,S as N}from"./supabase-Dp-5A4AM.js";import{A as b}from"./arrow-left-CjoguNl_.js";import{S as v}from"./send-B6ccho_s.js";function E(){const{id:l}=f(),i=j(),[a,o]=t.useState(null),[d,h]=t.useState([]),[n,m]=t.useState(""),[u,g]=t.useState(!0);t.useEffect(()=>{x()},[l]);const x=async()=>{try{const{data:s}=await c.from("exchanges").select("*").eq("id",l).maybeSingle();if(s){o(s);const{data:r}=await c.from("messages").select("*").eq("exchange_id",l).order("created_at",{ascending:!0});h(r||[])}}catch(s){console.error("Error fetching details:",s)}finally{g(!1)}},p=async s=>{if(s.preventDefault(),!!n.trim())try{await c.from("messages").insert({exchange_id:l,sender_type:"client",message:n}),m(""),x()}catch(r){console.error("Error sending message:",r)}};return u?e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600"})}):a?e.jsx("div",{className:"min-h-screen bg-slate-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>i("/client/exchanges"),className:"flex items-center text-slate-600 hover:text-slate-900 mb-6",children:[e.jsx(b,{className:"w-5 h-5 mr-2"}),"Retour aux échanges"]}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-4",children:"Détails de l'échange"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Code:"}),e.jsx("p",{className:"font-medium text-slate-900",children:a.exchange_code})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Statut:"}),e.jsx("p",{className:"font-medium text-slate-900",children:N[a.status]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Client:"}),e.jsx("p",{className:"font-medium text-slate-900",children:a.client_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Raison:"}),e.jsx("p",{className:"font-medium text-slate-900",children:a.reason})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-4",children:"Messages"}),e.jsx("div",{className:"space-y-4 mb-4 max-h-96 overflow-y-auto",children:d.length===0?e.jsx("p",{className:"text-slate-600 text-center py-8",children:"Aucun message"}):d.map(s=>e.jsxs("div",{className:`p-4 rounded-lg ${s.sender_type==="client"?"bg-emerald-50 ml-auto max-w-md":"bg-slate-100 mr-auto max-w-md"}`,children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 mb-1",children:s.sender_type==="client"?"Vous":"Commerçant"}),e.jsx("p",{className:"text-slate-700",children:s.message}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:new Date(s.created_at).toLocaleString("fr-FR")})]},s.id))}),e.jsxs("form",{onSubmit:p,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:s=>m(s.target.value),placeholder:"Votre message...",className:"flex-1 px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors",children:e.jsx(v,{className:"w-5 h-5"})})]})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Échange non trouvé"}),e.jsx("button",{onClick:()=>i("/client/exchanges"),className:"px-6 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700",children:"Retour aux échanges"})]})})}export{E as default};
